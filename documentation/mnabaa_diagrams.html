<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mnabaa Agentic Platform - Architecture Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/reactflow@11/dist/umd/index.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reactflow@11/dist/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #ffffff;
            color: #000000;
            padding: 40px 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #000000;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .subtitle {
            text-align: center;
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 60px;
            font-weight: 400;
        }

        .diagram-section {
            margin-bottom: 80px;
            page-break-inside: avoid;
        }

        .diagram-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #000000;
            border-left: 4px solid #DC143C;
            padding-left: 16px;
        }

        .diagram-description {
            font-size: 0.95rem;
            color: #444;
            margin-bottom: 20px;
            padding-left: 20px;
            line-height: 1.6;
        }

        .diagram-wrapper {
            width: 100%;
            height: 550px;
            border: 2px solid #E5E5E5;
            border-radius: 12px;
            background: #FAFAFA;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .react-flow__node {
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            font-weight: 500;
        }

        .react-flow__edge-path {
            stroke-width: 2;
        }

        .react-flow__controls {
            display: none;
        }

        .react-flow__attribution {
            display: none;
        }

        .react-flow__handle {
            opacity: 0 !important;
            width: 0 !important;
            height: 0 !important;
        }

        .node-label {
            text-align: center;
            line-height: 1.3;
        }

        .node-sublabel {
            font-size: 11px;
            color: #555;
            margin-top: 2px;
        }

        /* Color Legend Styling */
        .color-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
            padding: 12px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #333;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            border: 2px solid;
        }

        .legend-core { background: #DC143C; border-color: #B00020; }
        .legend-gcp { background: #4285F4; border-color: #1a73e8; }
        .legend-external { background: #34A853; border-color: #1e8e3e; }
        .legend-support { background: #9E9E9E; border-color: #757575; }

        @media print {
            .diagram-section {
                page-break-after: always;
            }
            
            .diagram-wrapper {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mnabaa Agentic Platform</h1>
        <p class="subtitle">Architecture Diagrams - Strategic Study</p>

        <div id="diagram1" class="diagram-section">
            <h2 class="diagram-title">1. Logical Architecture - Virtual Team Orchestration</h2>
            <p class="diagram-description">Supervisor-based delegation model with specialized agents communicating via standardized protocols (FastMCP). <strong>Stack:</strong> LangGraph for orchestration and observability, CrewAI for agent implementation, FastAPI and Uvicorn for the async server runtime. <strong>Governance:</strong> Cloud SDP (GCP managed service) for PII redaction at ingress, interrupt-based approval flow for high-risk actions (Human-in-Loop validated via IAP identity). <strong>Observability:</strong> LangGraph native state monitoring via built-in checkpointing and streaming, allowing real-time visibility into state changes without external tools.</p>
            <div class="diagram-wrapper" style="height: 520px; width: 1100px;"></div>
        </div>

        <div id="diagram2" class="diagram-section">
            <h2 class="diagram-title">2. Physical Architecture - GCP Secure Enclave</h2>
            <p class="diagram-description">Zero Trust deployment in europe-west9 (Paris) with VPC Service Controls, IAP auth, <strong>BigQuery</strong> (Warehouse), <strong>Knowledge Connectors</strong> (Drive, Confluence), and <strong>Cloud NAT</strong> for secure egress.</p>
            <div class="diagram-wrapper"></div>
        </div>


    </div>

    <script>
        const { useState, useCallback } = React;
        const ReactFlow = window.ReactFlow;
        const { Handle, Position } = ReactFlow;

        // Custom Node with 4 connectors
        const CustomNode = ({ data, style }) => {
            return React.createElement('div', { style: { ...style, position: 'relative' } },
                React.createElement('div', { className: 'node-content' }, 
                    React.createElement('div', { className: 'node-label', dangerouslySetInnerHTML: { __html: data.label.replace(/\n/g, '<br/>') } })
                ),
                // Top Handles
                React.createElement(Handle, { type: 'target', position: Position.Top, id: 'top-target', style: { top: 0, background: '#555', opacity: 0 } }),
                React.createElement(Handle, { type: 'source', position: Position.Top, id: 'top-source', style: { top: 0, background: '#555', opacity: 0 } }),
                // Right Handles
                React.createElement(Handle, { type: 'target', position: Position.Right, id: 'right-target', style: { right: 0, background: '#555', opacity: 0 } }),
                React.createElement(Handle, { type: 'source', position: Position.Right, id: 'right-source', style: { right: 0, background: '#555', opacity: 0 } }),
                // Bottom Handles
                React.createElement(Handle, { type: 'target', position: Position.Bottom, id: 'bottom-target', style: { bottom: 0, background: '#555', opacity: 0 } }),
                React.createElement(Handle, { type: 'source', position: Position.Bottom, id: 'bottom-source', style: { bottom: 0, background: '#555', opacity: 0 } }),
                // Left Handles
                React.createElement(Handle, { type: 'target', position: Position.Left, id: 'left-target', style: { left: 0, background: '#555', opacity: 0 } }),
                React.createElement(Handle, { type: 'source', position: Position.Left, id: 'left-source', style: { left: 0, background: '#555', opacity: 0 } }),
            );
        };

        const nodeTypes = {
            custom: CustomNode,
        };

        // Common styles - SIMPLIFIED 4-COLOR SCHEME
        // 1. Core Platform (Red): Orchestrator, Agents, Main Flow
        // 2. GCP Services (Blue): Cloud SQL, Vertex AI, BigQuery, etc.
        // 3. External Systems (Green): SaaS, External APIs
        // 4. Support (Gray): Observability, Storage, Config

        const coreRed = '#DC143C';
        const coreRedLight = '#FFE5E8';
        const coreRedDark = '#B00020';
        
        const gcpBlue = '#4285F4';
        const gcpBlueLight = '#E8F0FE';
        
        const externalGreen = '#34A853';
        const externalGreenLight = '#E8F5E9';
        
        const supportGray = '#9E9E9E';
        const supportGrayLight = '#F5F5F5';
        const supportGrayDark = '#757575';
        
        const black = '#000000';

        // Base node style (neutral)
        const defaultNodeStyle = {
            background: '#ffffff',
            border: `2px solid ${supportGray}`,
            borderRadius: '8px',
            padding: '14px 22px',
            color: black,
            fontSize: '13px',
            fontWeight: '500',
        };

        // Core Platform nodes (Red) - Orchestrator, Agents
        const coreNodeStyle = {
            background: coreRed,
            border: `2px solid ${coreRedDark}`,
            borderRadius: '8px',
            padding: '16px 24px',
            color: '#ffffff',
            fontSize: '14px',
            fontWeight: '600',
        };
        
        const coreNodeStyleOutline = {
            background: '#ffffff',
            border: `2px solid ${coreRed}`,
            borderRadius: '8px',
            padding: '14px 22px',
            color: black,
            fontSize: '13px',
            fontWeight: '500',
        };

        // GCP Service nodes (Blue)
        const gcpNodeStyle = {
            background: gcpBlueLight,
            border: `2px solid ${gcpBlue}`,
            borderRadius: '8px',
            padding: '14px 22px',
            color: black,
            fontSize: '13px',
            fontWeight: '500',
        };

        // External System nodes (Green)
        const externalNodeStyle = {
            background: externalGreenLight,
            border: `2px solid ${externalGreen}`,
            borderRadius: '8px',
            padding: '14px 22px',
            color: black,
            fontSize: '13px',
            fontWeight: '500',
        };

        // Support nodes (Gray) - Observability, Storage, Config
        const supportNodeStyle = {
            background: supportGrayLight,
            border: `2px solid ${supportGray}`,
            borderRadius: '8px',
            padding: '14px 22px',
            color: black,
            fontSize: '13px',
            fontWeight: '500',
        };

        // Group/Container style
        const groupNodeStyle = {
            background: coreRedLight,
            border: `2px dashed ${coreRed}`,
            borderRadius: '10px',
            padding: '24px',
            color: black,
        };

        // Edge styles per category
        const coreEdgeStyle = { stroke: coreRed, strokeWidth: 2 };
        const gcpEdgeStyle = { stroke: gcpBlue, strokeWidth: 2 };
        const externalEdgeStyle = { stroke: externalGreen, strokeWidth: 2 };
        const supportEdgeStyle = { stroke: supportGray, strokeWidth: 2 };

        // Diagram 1: Logical Architecture - Using simplified 4-color scheme
        const diagram1Nodes = [
            // LEGEND SUBGRAPH (bottom-centered)
            { id: 'legend-box', data: { label: '' }, position: { x: 200, y: 460 }, style: { background: '#fafafa', border: '1px solid #ddd', borderRadius: '8px', padding: '10px', width: 700, height: 40, fontSize: '11px', fontWeight: 600 }, zIndex: 10 },
            { id: 'legend-core', data: { label: '● Core Platform' }, position: { x: 220, y: 470 }, style: { background: 'transparent', border: 'none', color: coreRed, fontSize: '10px', fontWeight: 600, padding: '4px 8px' }, zIndex: 11 },
            { id: 'legend-gcp', data: { label: '● GCP Services' }, position: { x: 380, y: 470 }, style: { background: 'transparent', border: 'none', color: gcpBlue, fontSize: '10px', fontWeight: 600, padding: '4px 8px' }, zIndex: 11 },
            { id: 'legend-external', data: { label: '● External Systems' }, position: { x: 540, y: 470 }, style: { background: 'transparent', border: 'none', color: externalGreen, fontSize: '10px', fontWeight: 600, padding: '4px 8px' }, zIndex: 11 },
            { id: 'legend-support', data: { label: '● Support/Observability' }, position: { x: 700, y: 470 }, style: { background: 'transparent', border: 'none', color: supportGray, fontSize: '10px', fontWeight: 600, padding: '4px 8px' }, zIndex: 11 },

            // FastAPI/Uvicorn Server Container (background)
            { id: 'fastapi-container', data: { label: 'FastAPI Server' }, position: { x: 220, y: 60 }, style: { ...groupNodeStyle, width: 520, height: 380, fontSize: '12px', fontWeight: '600' }, zIndex: -1 },
            
            // LEFT COLUMN: User & GCP Services (stacked vertically)
            { id: '1', type: 'custom', data: { label: 'User' }, position: { x: 72, y: 200 }, style: defaultNodeStyle, zIndex: 10 },
            { id: 'dlp', type: 'custom', data: { label: 'Sensitive Data\nProtection' }, position: { x: 50, y: 300 }, style: { ...gcpNodeStyle, fontSize: '11px' }, zIndex: 10 },
            { id: 'cloud-sql', type: 'custom', data: { label: 'Cloud SQL' }, position: { x: 50, y: 50 }, style: { ...gcpNodeStyle, fontSize: '11px' }, zIndex: 10 },
            
            // CENTER: Supervisor (main focal point) - CORE
            { id: '2', type: 'custom', data: { label: 'Supervisor\n(LangGraph)' }, position: { x: 380, y: 160 }, style: { ...coreNodeStyle, width: 140 }, zIndex: 10 },

            // AGENT ROW: Multiple agents - CORE (all red, same category)
            { id: '3', type: 'custom', data: { label: 'Researcher Agent\n(CrewAI)' }, position: { x: 280, y: 280 }, style: { ...coreNodeStyleOutline, boxShadow: '0 0 8px rgba(220, 20, 60, 0.3)' }, zIndex: 11 },
            { id: 'sales-agent', type: 'custom', data: { label: 'Salesforce Agent\n(CrewAI)' }, position: { x: 450, y: 280 }, style: { ...coreNodeStyleOutline, boxShadow: '0 0 8px rgba(220, 20, 60, 0.3)' }, zIndex: 11 },
            { id: 'grouped-agents', type: 'custom', data: { label: 'Other Agents' }, position: { x: 610, y: 270 }, style: { ...coreNodeStyleOutline, border: `2px dashed ${coreRed}`, opacity: 0.7 }, zIndex: 10 },
            
            // TOOLS - CORE (red - part of agents)
            { id: '7', type: 'custom', data: { label: 'RAG Tool' }, position: { x: 280, y: 390 }, style: { ...coreNodeStyleOutline, fontSize: '11px' }, zIndex: 10 },
            { id: 'salesforce', type: 'custom', data: { label: 'Salesforce\n(FastMCP)' }, position: { x: 480, y: 370 }, style: { ...coreNodeStyleOutline, fontSize: '10px' }, zIndex: 10 },
            
            // RIGHT COLUMN: Observability Stack - SUPPORT (gray)
            { id: 'langsmith', type: 'custom', data: { label: 'LangGraph Monitor' }, position: { x: 620, y: 120 }, style: { ...supportNodeStyle, background: supportGray, border: `2px solid ${supportGrayDark}`, color: '#ffffff', fontSize: '11px' }, zIndex: 10 },
            { id: 'cloud-logging', type: 'custom', data: { label: 'Cloud Logging' }, position: { x: 800, y: 250 }, style: { ...gcpNodeStyle, fontSize: '11px' }, zIndex: 10 },
            { id: 'cloud-trace', type: 'custom', data: { label: 'Grafana' }, position: { x: 815.5, y: 370 }, style: { ...supportNodeStyle, fontSize: '11px' }, zIndex: 10 },
        ];

        const diagram1Edges = [
            // Main Flow: User -> SDP -> Supervisor - CORE (red)
            { id: 'e1-dlp', source: '1', target: 'dlp', style: { ...gcpEdgeStyle }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            { id: 'e-dlp-2', source: 'dlp', target: '2', label: 'Filtered', style: { ...coreEdgeStyle, strokeWidth: 3 }, labelStyle: { fill: coreRed, fontWeight: 700, fontSize: '11px' }, type: 'smoothstep', sourceHandle: 'right-source', targetHandle: 'left-target' },
            
            // State: Supervisor → SQL - GCP (blue)
            { id: 'e2-sql', source: '2', target: 'cloud-sql', label: 'Checkpoint', style: { ...gcpEdgeStyle, strokeDasharray: '4,4' }, labelStyle: { fill: gcpBlue, fontSize: '10px', fontWeight: 600 }, type: 'smoothstep', sourceHandle: 'left-source', targetHandle: 'right-target' },
            
            // Approval loop - SUPPORT (gray dashed)
            { id: 'e2-1-approval', source: '2', target: '1', style: { ...supportEdgeStyle, strokeDasharray: '5,5' }, type: 'smoothstep', sourceHandle: 'top-source', targetHandle: 'top-target' },
            
            // AGENTS: Supervisor -> Each Agent - CORE (all red now)
            { id: 'e2-3', source: '2', target: '3', label: 'Delegate', style: { ...coreEdgeStyle, strokeWidth: 3 }, labelStyle: { fill: coreRed, fontWeight: 700 }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            { id: 'e2-sales-agent', source: '2', target: 'sales-agent', style: { ...coreEdgeStyle }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            { id: 'e2-grouped', source: '2', target: 'grouped-agents', label: 'Interrupt', style: { ...coreEdgeStyle, strokeDasharray: '3,3' }, labelStyle: { fill: coreRed, fontSize: '9px', fontWeight: 600 }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            
            // TOOLS: Each Agent -> Its Tool - CORE (red)
            { id: 'e3-7', source: '3', target: '7', label: 'Tool', style: { ...coreEdgeStyle }, labelStyle: { fill: coreRed }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            { id: 'e-sales-agent-tool', source: 'sales-agent', target: 'salesforce', label: 'MCP', style: { ...coreEdgeStyle }, labelStyle: { fill: coreRed, fontSize: '9px' }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            
            // Observability: Supervisor -> Monitor - SUPPORT (gray)
            { id: 'e2-langsmith', source: '2', target: 'langsmith', label: 'Stream', style: { ...supportEdgeStyle, strokeDasharray: '5,5' }, labelStyle: { fill: supportGray, fontSize: '10px' }, type: 'smoothstep', sourceHandle: 'right-source', targetHandle: 'left-target' },
            
            // Observability vertical stack - SUPPORT (gray) & GCP (blue)
            { id: 'e-langsmith-logging', source: 'langsmith', target: 'cloud-logging', style: { ...supportEdgeStyle }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            { id: 'e-logging-trace', source: 'cloud-logging', target: 'cloud-trace', style: { ...supportEdgeStyle }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
        ];

        // Diagram 2: Physical Architecture - Using simplified 4-color scheme
        const diagram2Nodes = [
            // LEGEND SUBGRAPH (bottom-centered) - Adjusted to avoid overlap with VPC
            { id: 'legend-box', data: { label: '' }, position: { x: 150, y: 500 }, style: { background: '#fafafa', border: '1px solid #ddd', borderRadius: '8px', padding: '10px', width: 650, height: 40, fontSize: '11px', fontWeight: 600 }, zIndex: 10 },
            { id: 'legend-core', data: { label: '● Core Platform' }, position: { x: 170, y: 510 }, style: { background: 'transparent', border: 'none', color: coreRed, fontSize: '10px', fontWeight: 600, padding: '4px 8px' }, zIndex: 11 },
            { id: 'legend-gcp', data: { label: '● GCP Services' }, position: { x: 330, y: 510 }, style: { background: 'transparent', border: 'none', color: gcpBlue, fontSize: '10px', fontWeight: 600, padding: '4px 8px' }, zIndex: 11 },
            { id: 'legend-external', data: { label: '● External Systems' }, position: { x: 490, y: 510 }, style: { background: 'transparent', border: 'none', color: externalGreen, fontSize: '10px', fontWeight: 600, padding: '4px 8px' }, zIndex: 11 },
            { id: 'legend-support', data: { label: '● Support/Config' }, position: { x: 650, y: 510 }, style: { background: 'transparent', border: 'none', color: supportGray, fontSize: '10px', fontWeight: 600, padding: '4px 8px' }, zIndex: 11 },

            // VPC perimeter background
            { id: 'vpc', type: 'custom', data: { label: 'VPC Service Control' }, position: { x: 200, y: 20 }, style: { ...groupNodeStyle, width: 500, height: 440, fontSize: '11px', fontWeight: 600 }, zIndex: -1 },

            // LEFT COLUMN: Ingress - CORE (red)
            { id: '1', type: 'custom', data: { label: 'Frontend\n(NextJs)' }, position: { x: 0, y: 200 }, style: defaultNodeStyle, zIndex: 10 },
            { id: '2', type: 'custom', data: { label: 'IAP Auth' }, position: { x: 0, y: 320 }, style: gcpNodeStyle, zIndex: 10 },

            // TOP ROW: Storage & Data - GCP (blue) & SUPPORT (gray)
            { id: 'bucket', type: 'custom', data: { label: 'GCS Bucket' }, position: { x: 230, y: 60 }, style: { ...supportNodeStyle, fontSize: '11px' }, zIndex: 10 },
            { id: 'bq', type: 'custom', data: { label: 'BigQuery' }, position: { x: 420, y: 60 }, style: { ...gcpNodeStyle }, zIndex: 10 },
            
            // CENTER: Cloud Run (main hub) - CORE (red)
            { id: '3', type: 'custom', data: { label: 'Cloud Run\n(Orchestrator)' }, position: { x: 400, y: 200 }, style: { ...coreNodeStyleOutline, border: `3px solid ${coreRed}`, fontWeight: 700, fontSize: '13px' }, zIndex: 10 },
            
            // MIDDLE ROW: Data layer - GCP (blue)
            { id: '4', type: 'custom', data: { label: 'Cloud SQL' }, position: { x: 230, y: 200 }, style: gcpNodeStyle, zIndex: 10 },
            { id: '6', type: 'custom', data: { label: 'Vertex AI' }, position: { x: 590, y: 230 }, style: gcpNodeStyle, zIndex: 10 },
            
            // BOTTOM ROW: Support services - SUPPORT (gray)
            { id: 'sa', type: 'custom', data: { label: 'Service Account' }, position: { x: 200, y: 350 }, style: { ...supportNodeStyle, fontSize: '11px' }, zIndex: 10 },
            { id: 'tasks', type: 'custom', data: { label: 'Cloud Tasks' }, position: { x: 400, y: 350 }, style: { ...gcpNodeStyle, fontSize: '11px' }, zIndex: 10 },
            { id: '5', type: 'custom', data: { label: 'Secrets' }, position: { x: 560, y: 350 }, style: { ...supportNodeStyle, fontSize: '11px' }, zIndex: 10 },

            // RIGHT COLUMN: Egress - GCP (blue)
            { id: 'nat', type: 'custom', data: { label: 'Cloud NAT' }, position: { x: 720, y: 140 }, style: { ...gcpNodeStyle, border: `2px dashed ${gcpBlue}`, fontSize: '11px' }, zIndex: 10 },

            // FAR RIGHT: External SaaS - EXTERNAL (green)
            { id: 'snow', type: 'custom', data: { label: 'ServiceNow' }, position: { x: 880, y: 50 }, style: { ...externalNodeStyle, fontSize: '11px' }, zIndex: 10 },
            { id: 'sales', type: 'custom', data: { label: 'Salesforce' }, position: { x: 880, y: 130 }, style: { ...externalNodeStyle, fontSize: '11px' }, zIndex: 10 },
            { id: 'confluence', type: 'custom', data: { label: 'Confluence\n(Atlassian Cloud)' }, position: { x: 880, y: 210 }, style: { ...externalNodeStyle, fontSize: '10px' }, zIndex: 10 },
            
            // Google Drive - EXTERNAL (green)
            { id: 'drive', type: 'custom', data: { label: 'Google Drive\n(Native)' }, position: { x: 720, y: 350 }, style: { ...externalNodeStyle, fontSize: '10px' }, zIndex: 10 },
            
            // Cloud Logging - GCP (blue)
            { id: 'cloud-logging', type: 'custom', data: { label: 'Cloud Logging' }, position: { x: 580, y: 60 }, style: { ...gcpNodeStyle, fontSize: '11px' }, zIndex: 10 },
        ];

        const diagram2Edges = [
            // Ingress - GCP (blue) since IAP is a GCP service
            { id: 'e1-2', source: '1', target: '2', label: 'HTTPS', style: gcpEdgeStyle, labelStyle: { fill: gcpBlue, fontSize: '9px', fontWeight: 600 }, sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            { id: 'e2-3', source: '2', target: '3', label: 'Signed JWT', style: { ...coreEdgeStyle, strokeWidth: 3 }, labelStyle: { fill: coreRed, fontWeight: 700, fontSize: '10px' }, sourceHandle: 'right-source', targetHandle: 'left-target' },
            
            // Streaming response - SUPPORT (gray - internal)
            { id: 'e3-1-stream', source: '3', target: '1', label: 'SSE/Stream', style: { ...supportEdgeStyle, strokeDasharray: '5,5' }, labelStyle: { fill: supportGray, fontSize: '9px', fontWeight: 600 }, type: 'smoothstep', sourceHandle: 'top-source', targetHandle: 'right-target' },
            
            // GCS event-driven - GCP (blue)
            { id: 'e-bucket-3', source: 'bucket', target: '3', label: 'Eventarc', style: gcpEdgeStyle, labelStyle: { fill: gcpBlue, fontSize: '9px', fontWeight: 600 }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            
            // Cloud Run connections - GCP (blue)
            { id: 'e3-4', source: '3', target: '4', label: 'TLS/IAM', style: gcpEdgeStyle, labelStyle: { fill: gcpBlue, fontSize: '9px' }, sourceHandle: 'left-source', targetHandle: 'right-target' },
            { id: 'e3-6', source: '3', target: '6', label: 'gRPC/IAM', style: gcpEdgeStyle, labelStyle: { fill: gcpBlue, fontSize: '9px' }, sourceHandle: 'right-source', targetHandle: 'left-target' },
            { id: 'e3-bq', source: '3', target: 'bq', label: 'IAM', style: gcpEdgeStyle, labelStyle: { fill: gcpBlue, fontSize: '9px' }, type: 'smoothstep', sourceHandle: 'top-source', targetHandle: 'bottom-target' },
            { id: 'e3-tasks', source: '3', target: 'tasks', label: 'IAM', style: gcpEdgeStyle, labelStyle: { fill: gcpBlue, fontSize: '9px' }, sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            { id: 'e3-5', source: '3', target: '5', label: 'IAM', style: supportEdgeStyle, labelStyle: { fill: supportGray, fontSize: '9px' }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            { id: 'e3-sa', source: '3', target: 'sa', label: 'Workload ID', style: { ...supportEdgeStyle, strokeDasharray: '3,3' }, labelStyle: { fill: supportGray, fontSize: '9px' }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            
            // Egress via NAT - GCP (blue)
            { id: 'e6-nat', source: '6', target: 'nat', label: 'Egress', style: { ...gcpEdgeStyle, strokeDasharray: '5,5' }, labelStyle: { fill: gcpBlue, fontSize: '9px' }, sourceHandle: 'right-source', targetHandle: 'left-target' },
            
            // NAT to External SaaS - EXTERNAL (green)
            { id: 'e-nat-snow', source: 'nat', target: 'snow', label: 'REST/OAuth', style: externalEdgeStyle, labelStyle: { fill: externalGreen, fontSize: '8px' }, type: 'smoothstep', sourceHandle: 'right-source', targetHandle: 'left-target' },
            { id: 'e-nat-sales', source: 'nat', target: 'sales', label: 'REST/OAuth', style: externalEdgeStyle, labelStyle: { fill: externalGreen, fontSize: '8px' }, sourceHandle: 'right-source', targetHandle: 'left-target' },
            { id: 'e-nat-confluence', source: 'nat', target: 'confluence', label: 'REST/OAuth', style: externalEdgeStyle, labelStyle: { fill: externalGreen, fontSize: '8px' }, type: 'smoothstep', sourceHandle: 'right-source', targetHandle: 'left-target' },
            
            // Google Drive - EXTERNAL (green)
            { id: 'e6-drive', source: '6', target: 'drive', label: 'PSC/OAuth', style: { ...externalEdgeStyle, strokeWidth: 2 }, labelStyle: { fill: externalGreen, fontSize: '9px', fontWeight: 700 }, type: 'smoothstep', sourceHandle: 'bottom-source', targetHandle: 'top-target' },
            
            // Cloud Logging - GCP (blue)
            { id: 'e3-logging', source: '3', target: 'cloud-logging', label: 'Logs', style: { ...gcpEdgeStyle, strokeDasharray: '4,4' }, labelStyle: { fill: gcpBlue, fontSize: '9px' }, type: 'smoothstep', sourceHandle: 'right-source', targetHandle: 'left-target' },
        ];

        // Diagram 3: Detailed GCP Infrastructure


        // Diagram 4: Functional Components


        // Diagram 5: Ingestion Pipeline


        // Diagram 6: CI/CD Pipeline


        // React Flow Component
        function FlowDiagram({ nodes, edges, containerId }) {
            return React.createElement(ReactFlow.default, {
                nodes: nodes,
                edges: edges,
                nodeTypes: nodeTypes,
                fitView: true,
                attributionPosition: 'bottom-left',
                nodesDraggable: false,
                nodesConnectable: false,
                elementsSelectable: false,
                zoomOnScroll: false,
                panOnScroll: false,
                zoomOnDoubleClick: false,
                preventScrolling: true,
                minZoom: 1,
                maxZoom: 1,
            });
        }

        // Render all diagrams
        const diagrams = [
            { id: 'diagram1', nodes: diagram1Nodes, edges: diagram1Edges },
            { id: 'diagram2', nodes: diagram2Nodes, edges: diagram2Edges },
        ];

        diagrams.forEach(({ id, nodes, edges }) => {
            const container = document.querySelector(`#${id} .diagram-wrapper`);
            const root = ReactDOM.createRoot(container);
            root.render(React.createElement(FlowDiagram, { nodes, edges, containerId: id }));
        });
    </script>
</body>
</html>
